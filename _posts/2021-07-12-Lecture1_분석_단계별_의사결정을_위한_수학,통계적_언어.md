---
title: '[time series] 분석 단계별 의사결정을 위한 수학/통계적 언어'
categories:
    - time series

tag:
    - data analysis
    - time series

last_modified_at: 2021-07-12T23:50:00+09:00
toc: true
---

<script type="text/javascript" 
src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML">
</script>

# 분석 단계별 의사결정을 위한 수학/통계적 언어

## 데이터 관점에 따른 분류

- **시계열분석 Target 데이터: 최소 시계열/시계열횡단면/패널 데이터 (횡단면 데이터 시계열분석 불가)**  
- **시계열분석 시간축: 초/분/시/일/월/년 등 (Tick 단위 이하 및 빛의 속도 이상 제외)**  

|  | 횡단면 데이터(Cross Sectional) | 시계열 데이터(Time Series) | 시계열 횡단면 데이터(Pooled Cross Section) | 패널 데이터(Panel) |
|--------------------------------|-----------------------------------------|--------------------------------------------|------------------------------------|---------------------------------------------|
| 정의 | 특정시점 + 다수독립변수 | 다수시점 + 특정독립변수 | 다수독립변수 + 다수시점 | 다수독립변수 + 다수시점 (동일 변수 및 시점) |
| 예시 | 2016년 16개 시도의 GRDP와 최종소비 | 연도별 전국 GRDP와 최종소비 | 연도별 16개 시도의 GRDP와 최종소비 | 연도별 16개 시도의 GRDP와 최종소비 |
| 특징 | 값 독립적, 모집단 중 특정 시점 표본추출 | 값 Serial-correlation/Trend/Seasonality 등 | 시점/변수 불일치로 공백 가능 | 시점/변수 일치로 연구자들이 가장 선호 |

{% raw %} <img src="https://wjdghwo.github.io/assets/img/timeseries/Data_Type.png" alt=""> {% endraw %}

- 시계열분석은 데이터간 시간적 특성이 있어야하므로 특정한 시점만 존재하는 횡단면 데이터는 분석이 불가능하다.
- 시계열분석을 위해 많이 볼 수 있는 데이터는 시계열 횡단면 데이터이며 이 데이터를 처리하여 분석에 용이하도록 패널 데이터로 전처리를 한다.

## 데이터 변수구분 및 개념정리
- **원데이터(Raw Data)**: 수집된 차례로 기록되어 처리되지 않고 순서화되지 않은 데이터 **(ex. Log, Table)**    
- **변수(Variable)**: 정보가 수집되는 특정한 개체나 대상 (보통 열(Column) 값들을 의미, feature라도고 부름)
- **질적변수 vs 양적변수**: 데이터의 특성에 따른 분류
    - 질적변수(Qualitative Variable): 변수의 값이 비수치적 특정 카테고리에 포함 시키도록 하는 변수 (ex.색상, 성별, 종교)
        - 명목변수(Nominal Variable): 변수의 값이 특정한 범주(Category)에 들어가지만 해당 범주간 순위는 존재하지 않는 것 (ex.혈액형)
        - 순위변수(Ordinal Variable): 변수의 값이 특정 범주에 들어가면서 변수의 값이 순위를 가지는 경우 (ex.성적)
    - 양적변수(Quantitative Variable): 변수의 값을 숫자로 나타 낼 수 있는 변수 (ex. 키, 몸무게, 소득)
        - 이산변수(Discrete Variable): 하나하나 셀 수 있는 변수 (ex.정수)
        - 연속변수(Continuous Variable): 이산변수와 다르게 변수의 값 사이에 무수히 많은 또 다른 값들이 존재하는 경우 (ex.실수)
            - 등간변수: 변수들 순서뿐만 아니라 순서 사이의 간격을 알 수 있는 변수
            - 비율변수: 등간변수의 특성에 더하여 측정데이터 간의 비율계산이 가능한 변수
- **독립변수 vs 종속변수**: 데이터의 관계에 따른 분류
    - 독립변수(Independent Variable): 다른 변수에 영향을 미치는 변수
    - 종속변수(Dependent Variable): 다른 변수에 영향을 미치지 못하고 다른 변수의 영향을 받는 변수
    

## 통계 기본용어 (Descriptive Statistics)

### 중심 통계량: 데이터의 중심경향을 나타내는 수치
- **[평균(Average)](https://en.wikipedia.org/wiki/Average)**: 표본데이터의 중심무게 (산술평균, 기하평균, 조화평균, 가중평균)  
- **[중앙값(Median)](https://en.wikipedia.org/wiki/Median)**: 순서를 가진 표본데이터의 가운데(50%)에 위치한 값
- **[최빈값(Mode)](https://en.wikipedia.org/wiki/Mode_(statistics))**: 표본데이터 중 가장 빈번한 값

<center><img src='https://wjdghwo.github.io/assets/img/timeseries/Statistics_MMM.png' width='200'></center>

### 변동 통계량: 데이터의 변동성을 나타내는 수치
- **범위(Range)**: 최대값과 최소값의 차이
- **편차(Deviation)**: 관측값과 평균의 차이
- **변동(Variation)**: 편차 제곱의 합
- **분산(Variance)**: 편차 제곱의 합을 데이터의 수로 나눈 값
    - $${Var} (X)=\operatorname {E} \left[(X-\mu )^{2}\right]$$
    - $${\displaystyle {\begin{aligned}\operatorname {Var} (X)&=\operatorname {E} \left[(X-\operatorname {E} [X])^{2}\right]\\[4pt]&=\operatorname {E} \left[X^{2}-2X\operatorname {E} [X]+\operatorname {E} [X]^{2}\right]\\[4pt]&=\operatorname {E} \left[X^{2}\right]-2\operatorname {E} [X]\operatorname {E} [X]+\operatorname {E} [X]^{2}\\[4pt]&=\operatorname {E} \left[X^{2}\right]-\operatorname {E} [X]^{2}\end{aligned}}}$$
- **표준편차(Standard Deviation)**: $$\sqrt{Var(X)}$$


### 형태 통계량: 데이터의 분포형태와 왜곡을 나타내는 수치
- **왜도(Skewness)**: 평균을 중심으로 좌우로 데이터가 편향되어 있는 정도
- **첨도(Kurtosis)**: 뾰족함 정도
    - 첨도에서 양 끝점이 빠르게 수렴하는지 천천히 수렴하는지 정도를 파악하여 Outlier 선정 기준, 데이터의 해석, 비즈니스의 방향성 결정에 도움을 준다.
    - ex. 아마존 : 첨도가 낮은 데이터에서 양 끝의 이상치로 분류될 수 있는 고객을 타겟 비지니스를 하여 충성도가 높은 고객을 확보할 수 있었다.
- **[이상치(Outlier)](https://en.wikipedia.org/wiki/Outlier)**: 오류로 판단하는 값이지만 기준이 불명확
 - 데이터 해석 및 도메인 지식을 활용하여 처리에 대한 기준 설정 및 처리가 중요

<center><img src='https://wjdghwo.github.io/assets/img/timeseries/Statistics_Skew_Kurt.gif' width='600'></center>





### 관계 통계량: 데이터간의 관계를 나타내는 수치
- **상관관계(Correlation)**: A변수의 변화와 B변수의 변화방향의 (선형적)유사성으로 표준화된 공분산이라고도 함

<center><img src='https://wjdghwo.github.io/assets/img/timeseries/Correlation.png' width='400'></center>

- **인과관계(Causality)**: A변수와 B변수중 하나는 원인이 되고 다른 하나는 결과가 되는 관계성

<center><img src='https://wjdghwo.github.io/assets/img/timeseriesCorrelation_Causation.PNG' width='500'></center>

- **예시:**
    - 아이스크림 판매량 vs 익사자의 수  
    - 화재 현장에 출동하는 소방대원 수 vs 화재의 규모   
    - 해적의 수가 감소됨과 동시에 지구 온난화가 증가됨  
    
우리가 원하는 결과는 인과관계를 밝혀내는 것이지만 데이터는 상관관계만 말을 해주고 있다. 따라서 결론을 내기 전 각 변수들끼리 현실에서 실제로 어떤 의미를 가지는지 파악해보는 것도 도움이 된다.    

### 함정
- **통계를 이용한 조작**: 특정하게 skew된 sample 수집, 편향된 모집단 설정 및 표본 수집, 임의로 outlier를 정하여 데이터의 편향성 확대
- 데이터 분석과정 및 결과 해석과정에서 이러한 함정이 없는지 확인은 필수이다.

## 기존주장과 신규주장의 비교(가설검정)
- **대부분의 분석은 "누구나" 할수 있는 "비교(A/B Test)"를 기반으로 하며, 일상생활부터 연구논문까지 다양**  
- **"설명력"과 "(모델)복잡도"는 반비례하는 경향이 있으며, 설명력이 수반되는 모델들은 가설검정 해석이 필수**

### 가설설정 조건 3가지:  
1. **상호배반적(Mutually Exclusive)**
     - 나의주장과 대중주장은 모호함 없이 독립적이어야함 (공통 부분이 없어야함)
     
     
     
2. **증명가능성(Demostrable)**
    - 성급한 일반화에 빠지지 않으려면 증명가능한 주장이나 범위로 내세워야 함  



3. **구체적(Specific)**
    - 충분히 구별되고 실현가능한 표현으로 정의되어야 함


### 가설검정 정리 및 절차:
- **모집단(Population)**: 연구(관심) 대상이 되는 전체 집단  
- **표본(Sample)**: 모집단에서 선택된 일부 집단
- **전수조사(Population Scale Test)**: 모집단 모두를 조사하는 방식으로 시간과 비용이 가장 비효율적인 방식 (ex.인구주택 총조사)
- **표본조사(Sample Scale Test)**: 표본집단을 조사하는 방식으로 시간과 비용을 크게 줄일 수 있으나 편향성(Bias) 문제 존재 (ex.출구조사, 여론조사)
    - [Sample을 편향되게 만드는 방법](https://cshlife.tistory.com/291)
    - [Sampling 과정에서 생기는 Bias 제거하는 방법](https://m.blog.naver.com/bluefish850/220698040249)  
- **추론통계(Statistical Inference)**: 모집단에서 샘플링한 표본집단을 가지고 모집단의 특성을 추론하고 그 신뢰성이 있는지 검정하는 것
    - 요즘은 내가 보유한 데이터를 표본으로, 보유하지 못하는 현실세계 전체의 데이터나 미래의 데이터를 모집단으로 보기도 함
    - 표본을 통해 모집단을 추정하기 때문에 표본의 특성이 모집단을 잘 반영해야 함
    - 표본의 기초통계(Descriptive Statistics) 확인을 통해 분포를 확인해야 함 (분포에 따라 분석 방법이 달라짐)
- **통계량(Statistic)**: 표본의 특성을 나타내는 수치  
- **모수(Parameter)**: 통계량을 통해 알게 된 모집단의 특성
- **표본오차(Sampling Error)**: 표본평균으로 모평균을 알아내는 것이 추론통계의 목적이기 때문에 "모평균-표본평균"으로 계산
    - 모평균은 모집단에서 표본추출을 통해 얻어진 표본평균으로 추정된 모집단의 특성이며, 절대 표본평균이 모평균을 그대로 나타내는 것은 아님!
- **중심극한정리(Central Limit Theorem)**:   
    **"전체 모집단에서 여러 번 Sample을 추출해라. 그리고 Sample마다 평균을 구해라.**  
    **이 평균들의 분포는 정규분포이며 전체 모집단의 평균으로 수렴한다."**
    
    - 통상적으로 n>30이면 중심극한정리를 만족한다고 여긴다.
    $${\bar{X} \overset{\alpha}{\sim} N(~\mu, \frac{\sigma^2}{n})}$$
    1. 모집단이 어떤 분포든 "Sample 평균"의 분포는 정규분포다.  
    2. "Sample 크기"가 클수록 "Sample 평균"의 분산은 낮아진다.  
    3. "Sample 분산"은 대체로 원집단 분산에 매우 근접한다.  
    4. Sample 평균과 분산만으로 모집단의 평균과 분산을 추론할 수 있다.  
    5. CLT를 통한 추론으로 모집단의 분포 형태까지 추론하지는 못한다.  
    (*모집단과 표본집단 비교 대신 표본집단간 비교 수렴에도 성립한다)
    
 

**1. 가설 설정**
- **대립가설(Alternative Hypothesis, $H_1$)**: 나의주장, 분석 방법별 정해져 있음(보통 차이가 있다/영향력이 있다/연관성이 있다/효과가 있다)  
- **귀무가설(Null Hypothesis, $H_0$)**: 대중주장, 분석 방법별 정해져 있음(보통 차이가 없다/영향력이 없다/연관성이 없다/효과가 없다)  
    
**2. 검정통계량 및 유의확률 추정**  
- **[검정통계량(Test Statistics)](https://en.wikipedia.org/wiki/Test_statistic)**: 대립가설(나의주장)과 귀무가설(대중주장)을 비교하기 위한 검증(Evaluation)지표값, 일명 "점추정"  
     - 검정통계량 로직:
        - 두 표본평균의 분포를 보려고 하면 분석이 어렵기 때문에, "두 표본의 차"만을 분석하면 간단해짐
        - X와 Y를 각각 추정하는 것보다 X-Y만 추정하면 훨씬 단순한 모형
        - 정규분포에서 정규분포를 빼도 정규분포

- **신뢰구간(Confidence Interval)**: 모수가 어느 범위 안에 있는지를 확률적으로 보여주는 방법 (검정통계량이 발생가능한 구간, 일명 "구간추정")

- **유의수준(Significant Level, $\alpha$)**: 
     **귀무가설(대중주장)이 참이라는 전제 하에, 대립가설(나의주장)이 참이라고 "오판"할 최대 확률**
     - **유의수준 5%:**  
         - 통계적인 가설검정에서 사용되는 기준값
         - 일반적으로 유의 수준은 α로 표시하고 95%의 신뢰도를 기준으로 한다면 (1−0.95)인 0.05값이 유의수준 값이 된다.
         - 가설검정(hypothesis test)의 절차에서 유의수준 값과 유의확률 값을 비교하여 통계적 유의성을 검정하게 된다.
    
- **신뢰수준(신뢰도, Confidence Level)**: 통계에서 어떠한 값이 알맞은 추정값이라고 믿을 수 있는 정도 (1-유의수준)


<center><img src='https://wjdghwo.github.io/assets/img/timeseries/Statistical-Significance-P-Value.png' width='600'></center>

- **양측검정/좌측검정/우측검정**:

| 양측검정 | 좌측검정 | 우측검정 |
|--------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------|
| <img src='https://wjdghwo.github.io/assets/img/timeseries/Statistics_Confidence_Interval2.png' width='400'> | <img src='https://wjdghwo.github.io/assets/img/timeseries/Statistics_Confidence_Interval3.png' width='400'> | <img src='https://wjdghwo.github.io/assets/img/timeseries/Statistics_Confidence_Interval4.png' width='400'> |

## 표본 추출(샘플링)의 중요성 및 대응 

> **중요성1. 모든 통계적 분석은 샘플이 모집단을 대표할 수 있다는 가정!**   
: 모집단의 특성을 통계로 설명하는 것은 제법 괜찮은 접근이지만, 샘플이 모집단을 대표하지 못하면 거짓말 분석결과(유의미하지 않은 통계)   

> **중요성2. 빅데이터라고 하더라도 결국 편향이 없을 수 없는 샘플!**   
: 많은 전문가들이 통계의 한계를 전문적인 이유로 설명하지 못하더라도 본능적으로 왜곡될 수 있음을 인지하고 있고, 아무리 공정하게 추출하려 해도 편향이 없을 수 없음을 인지해야 함 
     
     
- **장점:** 과학적 연구에서 표본조사가 전수조사보다 선호되는 이유     
    - 정보가 신속하게 필요한 경우, 데이터수집, 분석을 신속히 처리   
    - 신속한 의사결정시간에 따른 비효율을 줄이고 비용과 시간이 절약되어 경제적   
    - 샘플링 데이터의 정확도에 영향을 주는 오차는 "표본추출오차"와 "비표본오차"가 있는데,   
    표본추출오차는 샘플링 과정에서 발생하나 표본의 크기를 증가시키면 줄어드는 경향,   
    비표본오차는 데이터 수집이나 처리, 사람의 주관으로 발생하는 오차로 전수/표본조사 모두 존재,   
    샘플링이 데이터의 수집과정 상의 오류를 더 잘 통제가 가능기에 전수조사보다 비표본오차가 적어 정확도가 높음   
    - 모집단이 무한히 많거나 정확한 파악이 불가하거나 특정 집단에서만 수집된 데이터의 경우 전수조사가 불가하기에 불가피하게 표본조사를 시행해야 함   


- **단점:**   
    - 모집단 자체가 작은 경우 표본조사가 무의미 할 수 있음 
    - 데이터의 특성을 정확히 모르면서 샘플링을 하면 bias나 왜곡이 더욱 증가될 수 있음   
    - 모집단을 완벽하게 대표하는 표본을 선정하는 일은 쉽지 않음(그래도 안하는 것보단 나음)


> - 올바른 방법으로 표본 추출하는 법이 필요함


### 샘플링 방법론

- **Process:** 

<center><img src='https://wjdghwo.github.io/assets/img/timeseries/Sampling_Process.png' width='600'></center> 


- **Comparison:** 

|  | 확률표본(Probability Sample): 무작위추출 | 비확률표본(Nonprobability Sample): 작위추출 | 
|:-----------------------:|:------------------------------------------------------------------------------------:|:-------------------------------------------------------------------:| 
| 방법론 | 주관을 배재하고 각 샘플이 뽑힐 확률을 확률적(객관적)으로 균등하게 부여 => "확률표본" | 샘플이 뽑힐 확률을 수학/확률적인 방법을 따르지 않음 => "비확률표본" | 
| 장점 | 표본이 추출될 확률 사전적으로 알때 용이 | 표본이 추출될 확률 사전적으로 모를때 용이 | 
|  | 모수추정에 bias가 없음 | 모수추정에 bias가 있음 | 
|  | 추출기회가 독립적이라 대표성이 높음 | 추출기회가 독립적이 않아 대표성이 낮음 | 
| 단점 | 시간과 비용이 많이 듦(표본의 크기가 커야함) | 시간과 비용이 적게 듦(표본의 크키가 작아도됨) | 
| 모집단 일반화 | 가능 | 불가능(모집단의 대략적 성격 파악 목적) | 
| 표본오차(신뢰구간) 추정 | 가능 | 불가능 | 
| 종류 | 단순임의 표본추출 | 편의 표본추출 | 
|  | 체계적 표본추출 | 할당 표본추출 | 
|  | 비례층화 표본추출 | 자발적 표본추출 | 
|  | 다단계층화 표본추출 |  | 
|  | 군집 표본추출 |  |



### 확률표본(Probability Sample) 추출법 

- **세부종류:** 
<center><img src='https://wjdghwo.github.io/assets/img/timeseries/Sampling_Simplerandom.png' width='300'>
<center><img src='https://wjdghwo.github.io/assets/img/timeseries/Sampling_Systematic.png' width='300'>
<center><img src='https://wjdghwo.github.io/assets/img/timeseries/Sampling_Stratified.png' width='300'>
<center><img src='https://wjdghwo.github.io/assets/img/timeseries/Sampling_Cluster.png' width='300'>
  

- **요약:** 

| 종류 | 추출법 | 비고 | 
|:-----------------------------------------:|:--------------------------------------------------------------------------------------------------:|:----------------------------------------------------------------------------------------------------:| 
| 단순임의 표본추출(Simple Random Sampling) | 모집단으로 표본을 균등한 확률로 추출하는 것으로, 추출된 표본을 단순임의표본이라고 함 | 100명(남60,여40) 중 10명을 뽑을 시 전부 남자일 수 있어서 모집단의 특성을 반영하지 못하는 대표성 한계 | 
| 체계적 표본추출(Systematic Sampling) | 첫번째 표본을 무작위로 선정한 후 k번째 간격의 표본들을 선정함 | 단순임의추출의 대표성 한계를 줄이기 위해서이며 비용이 적게들고 정확성이 단순임의 추출보다 높은편 | 
|  |  | k는 모집단의 크기를 원하는 표본의 크기로 나누어 계산 | 
| 층화 표본추출(Stratified Sampling) | 모집단을 서로 겹치지 않는 여러 개의 층(부분집단)으로 구분 후, 각 층에서 단순임의추출로 표본 추출함 | 단순임의추출의 대표성 한계를 줄이기 위해 여러 층으로 구분하여 bias를 회피 | 
|  |  | 층간은 이질적이나 층내는 동질적인 데이터에 적합(ex. 개발 파트 vs 분석 파트) | 
| 군집 표본추출(Cluster sampling) | 모집단을 서로 인접한 값들로 묶어 집단을 구성후, 특정 집단의 일부 또는 전체를 표본으로 함 | 집단간은 동질적이나 집단내는 이질적인 데이터에 적합(ex. 분석파트1 vs 분석파트2) | 
|  |  | 집단간은 동질적이나 집단내는 이질적인 데이터에 적합(ex. 분석파트1 vs 분석파트2) |

### 비확률표본(Nonprobability Sample) 추출법 

- **세부종류:** 
<center><img src='https://wjdghwo.github.io/assets/img/timeseries/Sampling_Nonprobability.png' width='700'>


- **요약:** 

| 종류 | 추출법 | 비고 | 
|:-----------------------------------:|:---------------------------------------------------------------------------------------------:|:---------------------------------------------------------------------------------------:| 
| 편의 표본추출(Convenience Sampling) | 특정 집단이나, 계층 및 시간대로 데이터만을 대상으로 표본을 선정 | 시간과 비용이 적게 들지만 대표성 문제 아주 높음 | 
| 판단 표본추출(Purposive Sampling) | 분석가 주관으로 분석에 도움이 된다 판단되는 대상만을 표본으로 함 | 전문가여야 가능하며 그렇지 않으면 모집단의 대표성 문제 높음 | 
| 할당 표본추출(Quota Sampling) | 모집단이 여러 특성을 가질 경우 각 특성에 따라 층을 형성 후, 층별로 표본을 같게 또는 비례 선정 | 모집단의 특성을 잘 아는 전문가이어야 하마 그렇지 않으면 대표성 뿐 아니라 Bias 문제 높음 |

### 요약 

<center><img src='https://wjdghwo.github.io/assets/img/timeseries/Sampling_Summary.png' width='500'>


